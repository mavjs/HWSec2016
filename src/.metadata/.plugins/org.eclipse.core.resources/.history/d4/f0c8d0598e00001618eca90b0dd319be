package backend;

import java.io.*;
import java.security.*;
import java.security.interfaces.*;
import java.util.Date;
import java.util.LinkedList;
import java.math.BigInteger;
import java.security.spec.*;

import org.jmrtd.cert.*;
import org.jmrtd.cert.CVCPrincipal;
import org.jmrtd.cert.CVCertificateBuilder;
import org.jmrtd.cert.CardVerifiableCertificate;

public class Backend implements PublicKey, PrivateKey{
	
	// Deze klasse aanroepen van de functies om wat mee te doen

	public Backend(){
	}
	

	// Setting the monthly allowance that will be distributed to all chargingterminals
	public short monthlyAllowance(){
		//Maybe perform a check if a terminal is a valid CT. 
		short allowance = 50; 	//Max. value is 32767 (inclusive).
		return allowance;
	}
	
	// Return list of revoked 
	public LinkedList<Integer> revokedLists(){
		LinkedList<Integer> list = new LinkedList<Integer>();
		return list;
	}
	
	public static CardVerifiableCertificate createCertificate() {
		CVCertificateBuilder caBuilder;
		PublicKey publicKey;
		PrivateKey privateKey;
		CVCPrincipal caRef;
		String algorithmName;
		CVCPrincipal holderRef;
		CVCAuthorizationTemplate authZTemplate;
		String provider;
		Date validFrom;
		Date validTo;
		caBuilder = new CVCertificateBuilder();
		try {
			caBuilder.createCertificate(publicKey, privateKey, algorithmName, caRef, holderRef, authZTemplate, validFrom, validTo, provider);
			
		} catch (org.ejbca.cvc.exception.ConstructionException e){
			System.out.println("Error");
		}
		return 1;
	}


	@Override
	public String getAlgorithm() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public byte[] getEncoded() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public String getFormat() {
		// TODO Auto-generated method stub
		return null;
	}

	
	public static  RSAKeyGen(){
		try {
			System.out.println("Generating RSA keys, please wait...");
			KeyPairGenerator generator = KeyPairGenerator.getInstance("RSA");
			generator.initialize(1024);
			KeyPair keypair = generator.generateKeyPair();
		
			return keypair;
			
		} catch (Exception e){
			e.printStackTrace();
		}
		
	}
	
	public static void writeKey(Key key, String filename) throws IOException {
		FileOutputStream file = new FileOutputStream(filename);
		file.write(key.getEncoded());
		file.close();
	}
	
//	public static CardVerifiableCertificate createCertificate(){
		
//	} //certificateCreation(){
		//CVCertificateBuilder cabuilder = new CVCertificateBuilder();

}
